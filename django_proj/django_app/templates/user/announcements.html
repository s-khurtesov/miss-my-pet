{%  load static %}

{% include "_includes/header.html" %}

<div id="header" xmlns="http://www.w3.org/1999/html">
            <span>Announcements</span>

        {% include "_includes/logout.html" %}
    </div>
<div class="container">
    <div class="row">
        <div class="cell" id="page-content">
                <div class="grid_container">
                    <div class="my_button" onclick="location.href='/user/account';">
                        <p><i class="arrow left"></i> Go Back </p>
                         <form id="view_ann" action="/user/announcements" method="POST">
                             {% csrf_token %}
                                <input name="refresh" type="hidden" value=1>
                                <button class = "refresh_button" id="announcements_button" style="cursor:pointer">View all announcements</button>
                        </form>
                    </div>


                    {% for ann in announcements %}
                        <div class="ann_small_container" id="ann-{{ ann.id }}">
                            <div class="row">
                                <div class="cell" style="width: 30%; vertical-align: middle; padding: 5px" id="ann-photo-{{ ann.id }}">
<!--                                    TODO: Change this image to appropriate image from announcement-->
                                    <img src="{% static 'images/pet.png'%}" style="width: 100%; height: 100%; transform: scale(0.8);">
                                </div>
                                <div class="cell" style="width: 65%" id="ann-descr-{{ ann.id }}">
                                    <div class="ann_header">
                                        {{ ann.name }} {% if ann.type == 'F' %}found{% else %}lost{% endif %}!<br/><br/>

                                    </div>
                                    <b>User: </b><i>{{ ann.user_obj.username }}</i><br><br>
                                    {% if ann.description %}<b>Distinctive features: </b><i>{{ ann.description }}</i><br/><br/>{% endif %}
                                    <b>Last seen: </b><i>{{ ann.last_seen_timestamp }}</i>

                                </div>
                                <div class="cell" style="vertical-align: middle; width: 5%" id="ann-map-{{ ann.id }}">
                                    <div class="map">
                                        <!--<form name="form" id="ann-delete-form" method="post" action="/admin/account/announcements">
                                            {% csrf_token %}
                                            <input name="form_type" id="form_type" type="hidden" value="announcements"/>
                                            <input name="action" id="action" type="hidden" value="delete"/>
                                            <input name="ann_id" id="ann_id" type="hidden" value="{{ ann.id }}"/>-->
                                            <button id = "OpenMap-{{ ann.id }}" class="map_button"></button>
                                            <div id="my_modal" class="modal">
                                                <div class="modal_content">
                                                    <span class="close_modal_window">Ã—</span>
                                                    <div id="WinMap" style="width:100%;height:400px;"></div>
                                                </div>
                                            </div>

                                        <!--For module window-->
                                        <script>
                                            var modal = document.getElementById("my_modal");
                                             var btn = document.getElementById("OpenMap-{{ ann.id }}");
                                             var span = document.getElementsByClassName("close_modal_window")[0];

                                             btn.onclick = function () {
                                                modal.style.display = "block";
                                                var lat = {{ ann.last_seen_point_lat }};
                                                var lng = {{ ann.last_seen_point_lng }} ;

                                                initMap(lat,lng);
                                             }

                                             span.onclick = function () {
                                                modal.style.display = "none";
                                             }

                                             window.onclick = function (event) {
                                                if (event.target == modal) {
                                                    modal.style.display = "none";
                                                }
                                            }
                                        </script>

                                        <!--For map in module window-->
                                        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcaQCW9aWwn01HP5nVi0L7-5w6aaO8V0g&callback=initMap&libraries=drawing&v=weekly" async></script>

                                        <script>
                                            function initMap(lat,lng) {
                                            const myLatLng = { lat,lng };
                                            map = new google.maps.Map(document.getElementById("WinMap"), {
                                                zoom: 14,
                                                center: myLatLng,
                                            });

                                            var marker = new google.maps.Marker({
                                            position: myLatLng,
                                            map,
                                            });
                                            }
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    function funonload() {
        var refreshForm = document.createElement("form");
        refreshInput.method = "POST";
        refreshInput.action = "announcements";
        refreshInput.hidden = "hidden";

        var refreshInput = document.createElement("input");
        refreshInput.type = "hidden";
        refreshInput.name = "refresh";
        refreshInput.value = 1;
        refreshForm.appendChild(refreshInput);

        refreshForm.submit();
    }
    window.onload = funonload;
</script>


{% include "_includes/footer.html" %}